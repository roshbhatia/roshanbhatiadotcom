!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r=e();for(var s in r)("object"==typeof exports?exports:t)[s]=r[s]}}(self,(()=>(()=>{"use strict";var t={228:(t,e,r)=>{r.d(e,{CLOCKID_MONOTONIC:()=>n,CLOCKID_REALTIME:()=>s,Ciovec:()=>_,Dirent:()=>c,ERRNO_BADF:()=>i,ERRNO_INVAL:()=>f,FILETYPE_DIRECTORY:()=>u,FILETYPE_REGULAR_FILE:()=>h,Fdstat:()=>p,Filestat:()=>b,Iovec:()=>l,OFLAGS_CREAT:()=>y,OFLAGS_DIRECTORY:()=>m,OFLAGS_EXCL:()=>w,OFLAGS_TRUNC:()=>g,Prestat:()=>E,WHENCE_CUR:()=>d,WHENCE_END:()=>o,WHENCE_SET:()=>a});const s=0,n=1,i=8,f=28;class l{static read_bytes(t,e){let r=new l;return r.buf=t.getUint32(e,!0),r.buf_len=t.getUint32(e+4,!0),r}static read_bytes_array(t,e,r){let s=[];for(let n=0;n<r;n++)s.push(l.read_bytes(t,e+8*n));return s}}class _{static read_bytes(t,e){let r=new _;return r.buf=t.getUint32(e,!0),r.buf_len=t.getUint32(e+4,!0),r}static read_bytes_array(t,e,r){let s=[];for(let n=0;n<r;n++)s.push(_.read_bytes(t,e+8*n));return s}}const a=0,d=1,o=2,u=3,h=4;class c{length(){return 24+this.dir_name.byteLength}write_bytes(t,e,r){t.setBigUint64(r,this.d_next,!0),t.setBigUint64(r+8,this.d_ino,!0),t.setUint32(r+16,this.dir_name.length,!0),t.setUint8(r+20,this.d_type),e.set(this.dir_name,r+24)}constructor(t,e,r){this.d_ino=1n;let s=new TextEncoder("utf-8").encode(e);this.d_next=t,this.d_namlen=s.byteLength,this.d_type=r,this.dir_name=s}}class p{write_bytes(t,e){t.setUint8(e,this.fs_filetype),t.setUint16(e+2,this.fs_flags,!0),t.setBigUint64(e+8,this.fs_rights_base,!0),t.setBigUint64(e+16,this.fs_rights_inherited,!0)}constructor(t,e){this.fs_rights_base=0n,this.fs_rights_inherited=0n,this.fs_filetype=t,this.fs_flags=e}}const y=1,m=2,w=4,g=8;class b{write_bytes(t,e){t.setBigUint64(e,this.dev,!0),t.setBigUint64(e+8,this.ino,!0),t.setUint8(e+16,this.filetype),t.setBigUint64(e+24,this.nlink,!0),t.setBigUint64(e+32,this.size,!0),t.setBigUint64(e+38,this.atim,!0),t.setBigUint64(e+46,this.mtim,!0),t.setBigUint64(e+52,this.ctim,!0)}constructor(t,e){this.dev=0n,this.ino=0n,this.nlink=0n,this.atim=0n,this.mtim=0n,this.ctim=0n,this.filetype=t,this.size=BigInt(e)}}class R{write_bytes(t,e){t.setUint32(e,this.pr_name_len,!0)}constructor(t){this.pr_name_len=t}}class E{static dir(t){let e=new E;return e.tag=0,e.inner=new R(t),e}write_bytes(t,e){t.setUint32(e,this.tag,!0),this.inner.write_bytes(t,e+4)}}}},e={};function r(s){var n=e[s];if(void 0!==n)return n.exports;var i=e[s]={exports:{}};return t[s](i,i.exports,r),i.exports}r.d=(t,e)=>{for(var s in e)r.o(e,s)&&!r.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var s={};r.r(s),r.d(s,{Directory:()=>_,Fd:()=>f,File:()=>l,OpenDirectory:()=>d,OpenFile:()=>a,PreopenDirectory:()=>o,WASI:()=>i,strace:()=>u});var n=r(228);let i=class{start(t){this.inst=t,t.exports._start()}initialize(t){this.inst=t,t.exports._initialize()}constructor(t,e,r){this.args=[],this.env=[],this.fds=[],this.args=t,this.env=e,this.fds=r;let s=this;this.wasiImport={args_sizes_get(t,e){let r=new DataView(s.inst.exports.memory.buffer);r.setUint32(t,s.args.length,!0);let n=0;for(let t of s.args)n+=t.length+1;return r.setUint32(e,n,!0),0},args_get(t,e){let r=new DataView(s.inst.exports.memory.buffer),n=new Uint8Array(s.inst.exports.memory.buffer);for(let i=0;i<s.args.length;i++){r.setUint32(t,e,!0),t+=4;let f=new TextEncoder("utf-8").encode(s.args[i]);n.set(f,e),r.setUint8(e+f.length,0),e+=f.length+1}return 0},environ_sizes_get(t,e){let r=new DataView(s.inst.exports.memory.buffer);r.setUint32(t,s.env.length,!0);let n=0;for(let t of s.env)n+=t.length+1;return r.setUint32(e,n,!0),0},environ_get(t,r){let n=new DataView(s.inst.exports.memory.buffer),i=new Uint8Array(s.inst.exports.memory.buffer);for(let s=0;s<e.length;s++){n.setUint32(t,r,!0),t+=4;let f=new TextEncoder("utf-8").encode(e[s]);i.set(f,r),n.setUint8(r+f.length,0),r+=f.length+1}return 0},clock_res_get(t,e){throw"unimplemented"},clock_time_get(t,e,r){let i=new DataView(s.inst.exports.memory.buffer);if(t===n.CLOCKID_REALTIME)i.setBigUint64(r,1000000n*BigInt((new Date).getTime()),!0);else if(t==n.CLOCKID_MONOTONIC){let t;try{t=BigInt(Math.round(1e6*performance.now()))}catch(e){t=0n}i.setBigUint64(r,t,!0)}else i.setBigUint64(r,0n,!0);return 0},fd_advise:(t,e,r,i)=>null!=s.fds[t]?s.fds[t].fd_advise(e,r,i):n.ERRNO_BADF,fd_allocate:(t,e,r)=>null!=s.fds[t]?s.fds[t].fd_allocate(e,r):n.ERRNO_BADF,fd_close(t){if(null!=s.fds[t]){let e=s.fds[t].fd_close();return s.fds[t]=void 0,e}return n.ERRNO_BADF},fd_datasync:t=>null!=s.fds[t]?s.fds[t].fd_datasync():n.ERRNO_BADF,fd_fdstat_get(t,e){if(null!=s.fds[t]){let{ret:r,fdstat:n}=s.fds[t].fd_fdstat_get();return null!=n&&n.write_bytes(new DataView(s.inst.exports.memory.buffer),e),r}return n.ERRNO_BADF},fd_fdstat_set_flags:(t,e)=>null!=s.fds[t]?s.fds[t].fd_fdstat_set_flags(e):n.ERRNO_BADF,fd_fdstat_set_rights:(t,e,r)=>null!=s.fds[t]?s.fds[t].fd_fdstat_set_rights(e,r):n.ERRNO_BADF,fd_filestat_get(t,e){if(null!=s.fds[t]){let{ret:r,filestat:n}=s.fds[t].fd_filestat_get();return null!=n&&n.write_bytes(new DataView(s.inst.exports.memory.buffer),e),r}return n.ERRNO_BADF},fd_filestat_set_size:(t,e)=>null!=s.fds[t]?s.fds[t].fd_filestat_set_size(e):n.ERRNO_BADF,fd_filestat_set_times:(t,e,r,i)=>null!=s.fds[t]?s.fds[t].fd_filestat_set_times(e,r,i):n.ERRNO_BADF,fd_pread(t,e,r,i,f){let l=new DataView(s.inst.exports.memory.buffer),_=new Uint8Array(s.inst.exports.memory.buffer);if(null!=s.fds[t]){let a=n.Iovec.read_bytes_array(l,e,r),{ret:d,nread:o}=s.fds[t].fd_pread(_,a,i);return l.setUint32(f,o,!0),d}return n.ERRNO_BADF},fd_prestat_get(t,e){let r=new DataView(s.inst.exports.memory.buffer);if(null!=s.fds[t]){let{ret:n,prestat:i}=s.fds[t].fd_prestat_get();return null!=i&&i.write_bytes(r,e),n}return n.ERRNO_BADF},fd_prestat_dir_name(t,e,r){if(null!=s.fds[t]){let{ret:r,prestat_dir_name:n}=s.fds[t].fd_prestat_dir_name();return null!=n&&new Uint8Array(s.inst.exports.memory.buffer).set(n,e),r}return n.ERRNO_BADF},fd_pwrite(t,e,r,i,f){let l=new DataView(s.inst.exports.memory.buffer),_=new Uint8Array(s.inst.exports.memory.buffer);if(null!=s.fds[t]){let a=n.Ciovec.read_bytes_array(l,e,r),{ret:d,nwritten:o}=s.fds[t].fd_pwrite(_,a,i);return l.setUint32(f,o,!0),d}return n.ERRNO_BADF},fd_read(t,e,r,i){let f=new DataView(s.inst.exports.memory.buffer),l=new Uint8Array(s.inst.exports.memory.buffer);if(null!=s.fds[t]){let _=n.Iovec.read_bytes_array(f,e,r),{ret:a,nread:d}=s.fds[t].fd_read(l,_);return f.setUint32(i,d,!0),a}return n.ERRNO_BADF},fd_readdir(t,e,r,i,f){let l=new DataView(s.inst.exports.memory.buffer),_=new Uint8Array(s.inst.exports.memory.buffer);if(null!=s.fds[t]){let n=0;for(;;){let{ret:a,dirent:d}=s.fds[t].fd_readdir_single(i);if(0!=a)return l.setUint32(f,n,!0),a;if(null==d)break;let o=d.length();if(r-n<o)break;d.write_bytes(l,_,e),e+=o,n+=o,i=d.d_next}return l.setUint32(f,n,!0),0}return n.ERRNO_BADF},fd_renumber(t,e){if(null!=s.fds[t]&&null!=s.fds[e]){let r=s.fds[e].fd_close();return 0!=r?r:(s.fds[e]=s.fds[t],s.fds[t]=void 0,0)}return n.ERRNO_BADF},fd_seek(t,e,r,i){let f=new DataView(s.inst.exports.memory.buffer);if(null!=s.fds[t]){let{ret:n,offset:l}=s.fds[t].fd_seek(e,r);return f.setUint32(i,e,!0),n}return n.ERRNO_BADF},fd_sync:t=>null!=s.fds[t]?s.fds[t].fd_sync():n.ERRNO_BADF,fd_tell(t,e){let r=new DataView(s.inst.exports.memory.buffer);if(null!=s.fds[t]){let{ret:n,offset:i}=s.fds[t].fd_tell();return r.setUint32(e,i,!0),n}return n.ERRNO_BADF},fd_write(t,e,r,i){let f=new DataView(s.inst.exports.memory.buffer),l=new Uint8Array(s.inst.exports.memory.buffer);if(null!=s.fds[t]){let _=n.Ciovec.read_bytes_array(f,e,r),{ret:a,nwritten:d}=s.fds[t].fd_write(l,_);return f.setUint32(i,d,!0),a}return n.ERRNO_BADF},path_create_directory(t,e,r){let n=new Uint8Array(s.inst.exports.memory.buffer);if(null!=s.fds[t]){let i=new TextDecoder("utf-8").decode(n.slice(e,e+r));return s.fds[t].path_create_directory(i)}},path_filestat_get(t,e,r,i,f){let l=new DataView(s.inst.exports.memory.buffer),_=new Uint8Array(s.inst.exports.memory.buffer);if(null!=s.fds[t]){let n=new TextDecoder("utf-8").decode(_.slice(r,r+i)),{ret:a,filestat:d}=s.fds[t].path_filestat_get(e,n);return null!=d&&d.write_bytes(l,f),a}return n.ERRNO_BADF},path_filestat_set_times(t,e,r,i,f,l,_){let a=new Uint8Array(s.inst.exports.memory.buffer);if(null!=s.fds[t]){let n=new TextDecoder("utf-8").decode(a.slice(r,r+i));return s.fds[t].path_filestat_set_times(e,n,f,l,_)}return n.ERRNO_BADF},path_link(t,e,r,i,f,l,_){let a=new Uint8Array(s.inst.exports.memory.buffer);if(null!=s.fds[t]&&null!=s.fds[f]){let n=new TextDecoder("utf-8").decode(a.slice(r,r+i)),d=new TextDecoder("utf-8").decode(a.slice(l,l+_));return s.fds[f].path_link(t,e,n,d)}return n.ERRNO_BADF},path_open(t,e,r,i,f,l,_,a,d){let o=new DataView(s.inst.exports.memory.buffer),u=new Uint8Array(s.inst.exports.memory.buffer);if(null!=s.fds[t]){let n=new TextDecoder("utf-8").decode(u.slice(r,r+i)),{ret:h,fd_obj:c}=s.fds[t].path_open(e,n,f,l,_,a);if(0!=h)return h;s.fds.push(c);let p=s.fds.length-1;return o.setUint32(d,p,!0),0}return n.ERRNO_BADF},path_readlink(t,e,r,i,f,l){let _=new DataView(s.inst.exports.memory.buffer),a=new Uint8Array(s.inst.exports.memory.buffer);if(null!=s.fds[t]){let d=new TextDecoder("utf-8").decode(a.slice(e,e+r)),{ret:o,data:u}=s.fds[t].path_readlink(d);if(null!=u){if(u.length>f)return _.setUint32(l,0,!0),n.ERRNO_BADF;a.set(u,i),_.setUint32(l,u.length,!0)}return o}return n.ERRNO_BADF},path_remove_directory(t,e,r){let i=new Uint8Array(s.inst.exports.memory.buffer);if(null!=s.fds[t]){let n=new TextDecoder("utf-8").decode(i.slice(e,e+r));return s.fds[t].path_remove_directory(n)}return n.ERRNO_BADF},path_rename(t,e,r,s,n,i){throw"FIXME what is the best abstraction for this?"},path_symlink(t,e,r,i,f){let l=new Uint8Array(s.inst.exports.memory.buffer);if(null!=s.fds[r]){let n=new TextDecoder("utf-8").decode(l.slice(t,t+e)),_=new TextDecoder("utf-8").decode(l.slice(i,i+f));return s.fds[r].path_symlink(n,_)}return n.ERRNO_BADF},path_unlink_file(t,e,r){let i=new Uint8Array(s.inst.exports.memory.buffer);if(null!=s.fds[t]){let n=new TextDecoder("utf-8").decode(i.slice(e,e+r));return s.fds[t].path_unlink_file(n)}return n.ERRNO_BADF},poll_oneoff(t,e,r){throw"async io not supported"},proc_exit(t){throw"exit with exit code "+t},proc_raise(t){throw"raised signal "+t},sched_yield(){},random_get(t,e){let r=new Uint8Array(s.inst.exports.memory.buffer);for(let s=0;s<e;s++)r[t+s]=256*Math.random()|0},sock_recv(t,e,r){throw"sockets not supported"},sock_send(t,e,r){throw"sockets not supported"},sock_shutdown(t,e){throw"sockets not supported"}}}};class f{fd_advise(t,e,r){return-1}fd_allocate(t,e){return-1}fd_close(){return-1}fd_datasync(){return-1}fd_fdstat_get(){return{ret:-1,fdstat:null}}fd_fdstat_set_flags(t){return-1}fd_fdstat_set_rights(t,e){return-1}fd_filestat_get(){return{ret:-1,filestat:null}}fd_filestat_set_size(t){return-1}fd_filestat_set_times(t,e,r){return-1}fd_pread(t,e,r){return{ret:-1,nread:0}}fd_prestat_get(){return{ret:-1,prestat:null}}fd_prestat_dir_name(t,e){return{ret:-1,prestat_dir_name:null}}fd_pwrite(t,e,r){return{ret:-1,nwritten:0}}fd_read(t,e){return{ret:-1,nread:0}}fd_readdir_single(t){return{ret:-1,dirent:null}}fd_seek(t,e){return{ret:-1,offset:0}}fd_sync(){return-1}fd_tell(){return{ret:-1,offset:0}}fd_write(t,e){return{ret:-1,nwritten:0}}path_create_directory(t){return-1}path_filestat_get(t,e){return{ret:-1,filestat:null}}path_filestat_set_times(t,e,r,s,n){return-1}path_link(t,e,r,s){return-1}path_open(t,e,r,s,n,i){return{ret:-1,fd_obj:null}}path_readlink(t){return{ret:-1,data:null}}path_remove_directory(t){return-1}path_rename(t,e,r){return-1}path_symlink(t,e){return-1}path_unlink_file(t){return-1}}class l{get size(){return this.data.byteLength}stat(){return new n.Filestat(n.FILETYPE_REGULAR_FILE,this.size)}truncate(){this.data=new Uint8Array([])}constructor(t){this.data=new Uint8Array(t)}}class _{stat(){return new n.Filestat(n.FILETYPE_DIRECTORY,0)}get_entry_for_path(t){let e=this;for(let r of t.split("/")){if(""==r)break;if(null==this.contents[r])return null;e=this.contents[r]}return e}create_entry_for_path(t){let e=this,r=t.split("/").filter((t=>"/"!=t));for(let t=0;t<r.length;t++){let s=r[t];null!=e.contents[s]||(t==r.length-1?e.contents[s]=new l(new ArrayBuffer(0)):e.contents[s]=new _({})),e=e.contents[s]}return e}constructor(t){this.contents=t}}class a extends f{fd_fdstat_get(){return{ret:0,fdstat:new n.Fdstat(n.FILETYPE_REGULAR_FILE,0)}}fd_read(t,e){let r=0;for(let s of e){if(!(this.file_pos<this.file.data.byteLength))break;{let e=this.file.data.slice(Number(this.file_pos),Number(this.file_pos+BigInt(s.buf_len)));t.set(e,s.buf),this.file_pos+=BigInt(e.length),r+=e.length}}return{ret:0,nread:r}}fd_seek(t,e){let r;switch(e){case n.WHENCE_SET:r=t;break;case n.WHENCE_CUR:r=this.file_pos+t;break;case n.WHENCE_END:r=this.file.data.byteLength+t;break;default:return{ret:n.ERRNO_INVAL,offset:0}}return r<0?{ret:n.ERRNO_INVAL,offset:0}:(this.file_pos=BigInt(r),{ret:0,offset:r})}fd_write(t,e){let r=0;for(let s of e){let e=t.slice(s.buf,s.buf+s.buf_len);if(this.file_pos+BigInt(e.byteLength)>this.file.size){let t=this.file.data;this.file.data=new Uint8Array(Number(this.file_pos+BigInt(e.byteLength))),this.file.data.set(t)}this.file.data.set(e.slice(0,this.file.size-Number(this.file_pos)),Number(this.file_pos)),this.file_pos+=BigInt(e.byteLength),r+=s.buf_len}return{ret:0,nwritten:r}}fd_filestat_get(){return{ret:0,filestat:this.file.stat()}}constructor(t){super(),this.file_pos=0n,this.file=t}}class d extends f{fd_fdstat_get(){return{ret:0,fdstat:new n.Fdstat(n.FILETYPE_DIRECTORY,0)}}fd_readdir_single(t){if(t>=BigInt(Object.keys(this.dir.contents).length))return{ret:0,dirent:null};let e=Object.keys(this.dir.contents)[Number(t)],r=this.dir.contents[e];return new TextEncoder("utf-8").encode(e),{ret:0,dirent:new n.Dirent(t+1n,e,r.stat().filetype)}}path_filestat_get(t,e){let r=this.dir.get_entry_for_path(e);return null==r?{ret:-1,filestat:null}:{ret:0,filestat:r.stat()}}path_open(t,e,r,s,i,f){let o=this.dir.get_entry_for_path(e);if(null==o){if((r&n.OFLAGS_CREAT)!=n.OFLAGS_CREAT)return{ret:-1,fd_obj:null};o=this.dir.create_entry_for_path(e)}else if((r&n.OFLAGS_EXCL)==n.OFLAGS_EXCL)return{ret:-1,fd_obj:null};if((r&n.OFLAGS_DIRECTORY)==n.OFLAGS_DIRECTORY&&o.stat().filetype!=n.FILETYPE_DIRECTORY)return{ret:-1,fd_obj:null};if((r&n.OFLAGS_TRUNC)==n.OFLAGS_TRUNC&&o.truncate(),o instanceof l)return{ret:0,fd_obj:new a(o)};if(o instanceof _)return{ret:0,fd_obj:new d(o)};throw"dir entry neither file nor dir"}constructor(t){super(),this.dir=t}}class o extends d{fd_prestat_get(){return{ret:0,prestat:n.Prestat.dir(this.prestat_name.length)}}fd_prestat_dir_name(){return{ret:0,prestat_dir_name:this.prestat_name}}constructor(t,e){super(new _(e)),this.prestat_name=new TextEncoder("utf-8").encode(t)}}function u(t,e){return new Proxy(t,{get(t,r,s){let n=Reflect.get(t,r,s);return e.includes(r)?n:function(...t){return console.log(r,"(",...t,")"),Reflect.apply(n,s,t)}}})}return s})()));